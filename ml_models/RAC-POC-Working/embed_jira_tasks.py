import os
import shutil
from langchain_community.vectorstores import Chroma
from langchain_community.embeddings import OllamaEmbeddings
from langchain.docstore.document import Document
import json

# Clear existing vector database
persist_directory = "./jira_tasks_chroma_db"
if os.path.exists(persist_directory):
    print(f"Clearing existing vector database at {persist_directory}")
    shutil.rmtree(persist_directory)
    print("Existing vector database cleared.")

jira_tasks = [
    {"issueKey": "JIRA-101", "summary": "Implement user authentication", "issueType": "Story", "status": "In Progress", "priority": "High", "assignee": "john.doe", "reporter": "jane.smith", "created": "2025-01-06T04:30:00.000+00:00", "updated": "2025-07-25T13:01:22.673+00:00", "resolution": "Unresolved", "description": "Develop a secure login system with OAuth2 for the web app.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-102", "summary": "Fix payment gateway bug", "issueType": "Bug", "status": "To Do", "priority": "Medium", "assignee": "alice.johnson", "reporter": "bob.wilson", "created": "2025-01-07T09:15:00.000+00:00", "updated": "2025-07-25T14:30:00.000+00:00", "resolution": "Unresolved", "description": "Resolve issue with Stripe payment failing for certain credit cards.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-103", "summary": "Optimize database queries", "issueType": "Task", "status": "Done", "priority": "Medium", "assignee": "david.chen", "reporter": "sarah.miller", "created": "2025-01-08T11:20:00.000+00:00", "updated": "2025-07-20T16:45:00.000+00:00", "resolution": "Fixed", "description": "Improve performance of SQL queries for user data retrieval.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-104", "summary": "Add dark mode support", "issueType": "Story", "status": "In Review", "priority": "Low", "assignee": "emma.davis", "reporter": "mike.brown", "created": "2025-01-09T13:45:00.000+00:00", "updated": "2025-07-25T10:20:00.000+00:00", "resolution": "Unresolved", "description": "Implement dark mode toggle for better user experience.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-105", "summary": "Update session management", "issueType": "Task", "status": "In Progress", "priority": "High", "assignee": "chris.lee", "reporter": "lisa.wang", "created": "2025-01-10T08:30:00.000+00:00", "updated": "2025-07-25T15:10:00.000+00:00", "resolution": "Unresolved", "description": "Enhance session handling to prevent timeouts during user activity.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-106", "summary": "Integrate email notifications", "issueType": "Story", "status": "To Do", "priority": "Medium", "assignee": "tom.anderson", "reporter": "rachel.green", "created": "2025-01-11T14:20:00.000+00:00", "updated": "2025-07-25T12:05:00.000+00:00", "resolution": "Unresolved", "description": "Add email alerts for user account changes.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-107", "summary": "Refactor API endpoints", "issueType": "Task", "status": "Done", "priority": "Medium", "assignee": "kevin.zhang", "reporter": "amanda.white", "created": "2025-01-12T10:15:00.000+00:00", "updated": "2025-07-18T17:30:00.000+00:00", "resolution": "Fixed", "description": "Simplify REST API structure for better maintainability.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-108", "summary": "Add multi-language support", "issueType": "Story", "status": "In Review", "priority": "Low", "assignee": "maria.garcia", "reporter": "james.taylor", "created": "2025-01-13T16:40:00.000+00:00", "updated": "2025-07-25T11:25:00.000+00:00", "resolution": "Unresolved", "description": "Enable localization for English and Spanish in the web app.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-109", "summary": "Fix search functionality", "issueType": "Bug", "status": "To Do", "priority": "High", "assignee": "alex.kumar", "reporter": "sophie.clark", "created": "2025-01-14T12:10:00.000+00:00", "updated": "2025-07-25T13:50:00.000+00:00", "resolution": "Unresolved", "description": "Resolve issue with search returning incomplete results.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-110", "summary": "Enhance dashboard UI", "issueType": "Story", "status": "In Progress", "priority": "Medium", "assignee": "daniel.rodriguez", "reporter": "emily.thomas", "created": "2025-01-15T09:25:00.000+00:00", "updated": "2025-07-25T14:15:00.000+00:00", "resolution": "Unresolved", "description": "Improve dashboard layout for better usability.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-111", "summary": "Configure CI/CD pipeline", "issueType": "Task", "status": "Done", "priority": "High", "assignee": "ryan.martinez", "reporter": "jessica.adams", "created": "2025-01-16T11:50:00.000+00:00", "updated": "2025-07-22T16:20:00.000+00:00", "resolution": "Fixed", "description": "Set up automated testing and deployment for the backend.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-112", "summary": "Test mobile responsiveness", "issueType": "Task", "status": "In Review", "priority": "Medium", "assignee": "ashley.nguyen", "reporter": "brandon.lewis", "created": "2025-01-17T13:35:00.000+00:00", "updated": "2025-07-25T10:40:00.000+00:00", "resolution": "Unresolved", "description": "Ensure web app is fully responsive on mobile devices.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-113", "summary": "Upgrade security module", "issueType": "Story", "status": "To Do", "priority": "High", "assignee": "michael.hernandez", "reporter": "stephanie.moore", "created": "2025-01-18T15:20:00.000+00:00", "updated": "2025-07-25T12:30:00.000+00:00", "resolution": "Unresolved", "description": "Implement two-factor authentication for enhanced security.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-114", "summary": "Optimize file upload", "issueType": "Task", "status": "In Progress", "priority": "Medium", "assignee": "jennifer.lopez", "reporter": "robert.allen", "created": "2025-01-19T08:45:00.000+00:00", "updated": "2025-07-25T15:35:00.000+00:00", "resolution": "Unresolved", "description": "Reduce upload times for large files in the web app.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-115", "summary": "Add analytics tracking", "issueType": "Story", "status": "Done", "priority": "Low", "assignee": "william.scott", "reporter": "nicole.young", "created": "2025-01-20T10:30:00.000+00:00", "updated": "2025-07-19T17:15:00.000+00:00", "resolution": "Fixed", "description": "Integrate Google Analytics for user behavior tracking.", "projectId": "Adani", "sprintId": "Sprint-1"},
    {"issueKey": "JIRA-116", "summary": "Resolve caching issues", "issueType": "Bug", "status": "In Review", "priority": "Medium", "assignee": "elizabeth.hall", "reporter": "christopher.king", "created": "2025-01-21T12:55:00.000+00:00", "updated": "2025-07-25T11:10:00.000+00:00", "resolution": "Unresolved", "description": "Fix stale data issues in the caching layer.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-117", "summary": "Implement user profile page", "issueType": "Story", "status": "To Do", "priority": "Medium", "assignee": "matthew.wright", "reporter": "lauren.hill", "created": "2025-01-22T14:15:00.000+00:00", "updated": "2025-07-25T13:25:00.000+00:00", "resolution": "Unresolved", "description": "Add a page for users to edit their profile details.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-118", "summary": "Update frontend framework", "issueType": "Task", "status": "In Progress", "priority": "High", "assignee": "andrew.green", "reporter": "victoria.baker", "created": "2025-01-23T16:40:00.000+00:00", "updated": "2025-07-25T14:50:00.000+00:00", "resolution": "Unresolved", "description": "Upgrade to React 18 for better performance.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-119", "summary": "Fix login page errors", "issueType": "Bug", "status": "Done", "priority": "High", "assignee": "joshua.adams", "reporter": "samantha.nelson", "created": "2025-01-24T09:10:00.000+00:00", "updated": "2025-07-21T16:45:00.000+00:00", "resolution": "Fixed", "description": "Resolve validation errors on the login form.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-120", "summary": "Add data export feature", "issueType": "Story", "status": "In Review", "priority": "Low", "assignee": "tyler.carter", "reporter": "madison.mitchell", "created": "2025-01-25T11:25:00.000+00:00", "updated": "2025-07-25T10:55:00.000+00:00", "resolution": "Unresolved", "description": "Allow users to export data as CSV files.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-121", "summary": "Improve API response time", "issueType": "Task", "status": "To Do", "priority": "High", "assignee": "nathan.roberts", "reporter": "hannah.turner", "created": "2025-01-26T13:50:00.000+00:00", "updated": "2025-07-25T12:40:00.000+00:00", "resolution": "Unresolved", "description": "Optimize backend API for faster responses.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-122", "summary": "Test cross-browser compatibility", "issueType": "Task", "status": "In Progress", "priority": "Medium", "assignee": "benjamin.phillips", "reporter": "olivia.campbell", "created": "2025-01-27T15:15:00.000+00:00", "updated": "2025-07-25T15:20:00.000+00:00", "resolution": "Unresolved", "description": "Ensure app works on Chrome, Firefox, and Safari.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-123", "summary": "Remove deprecated code", "issueType": "Task", "status": "Done", "priority": "Low", "assignee": "ethan.parker", "reporter": "grace.evans", "created": "2025-01-28T17:30:00.000+00:00", "updated": "2025-07-17T18:10:00.000+00:00", "resolution": "Fixed", "description": "Clean up old code from the backend services.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-124", "summary": "Enhance error handling", "issueType": "Story", "status": "In Review", "priority": "Medium", "assignee": "aiden.edwards", "reporter": "chloe.collins", "created": "2025-01-29T10:45:00.000+00:00", "updated": "2025-07-25T11:35:00.000+00:00", "resolution": "Unresolved", "description": "Improve error messages for better user feedback.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-125", "summary": "Integrate push notifications", "issueType": "Story", "status": "To Do", "priority": "Medium", "assignee": "logan.stewart", "reporter": "zoey.sanchez", "created": "2025-01-30T12:20:00.000+00:00", "updated": "2025-07-25T13:15:00.000+00:00", "resolution": "Unresolved", "description": "Add push notifications for mobile app updates.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-126", "summary": "Fix user session bugs", "issueType": "Bug", "status": "In Progress", "priority": "High", "assignee": "carter.morris", "reporter": "lily.rogers", "created": "2025-01-31T14:35:00.000+00:00", "updated": "2025-07-25T14:25:00.000+00:00", "resolution": "Unresolved", "description": "Resolve issues with user sessions expiring unexpectedly.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-127", "summary": "Optimize image loading", "issueType": "Task", "status": "Done", "priority": "Low", "assignee": "owen.reed", "reporter": "ava.cook", "created": "2025-02-01T16:50:00.000+00:00", "updated": "2025-07-20T17:30:00.000+00:00", "resolution": "Fixed", "description": "Implement lazy loading for images to reduce page load time.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-128", "summary": "Add password reset feature", "issueType": "Story", "status": "In Review", "priority": "Medium", "assignee": "gavin.morgan", "reporter": "ellie.bell", "created": "2025-02-02T09:05:00.000+00:00", "updated": "2025-07-25T10:30:00.000+00:00", "resolution": "Unresolved", "description": "Enable users to reset passwords via email link.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-129", "summary": "Update database schema", "issueType": "Task", "status": "To Do", "priority": "High", "assignee": "landon.murphy", "reporter": "scarlett.bailey", "created": "2025-02-03T11:30:00.000+00:00", "updated": "2025-07-25T12:20:00.000+00:00", "resolution": "Unresolved", "description": "Modify schema to support new user roles.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-130", "summary": "Implement rate limiting", "issueType": "Story", "status": "In Progress", "priority": "High", "assignee": "hunter.cox", "reporter": "aubrey.cooper", "created": "2025-02-04T13:55:00.000+00:00", "updated": "2025-07-25T15:05:00.000+00:00", "resolution": "Unresolved", "description": "Add rate limiting to API endpoints for security.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-131", "summary": "Fix broken links", "issueType": "Bug", "status": "Done", "priority": "Medium", "assignee": "levi.richardson", "reporter": "riley.ward", "created": "2025-02-05T15:20:00.000+00:00", "updated": "2025-07-18T16:15:00.000+00:00", "resolution": "Fixed", "description": "Resolve 404 errors on the help page.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-132", "summary": "Add form validation", "issueType": "Story", "status": "In Review", "priority": "Medium", "assignee": "sebastian.torres", "reporter": "nora.peterson", "created": "2025-02-06T17:45:00.000+00:00", "updated": "2025-07-25T11:45:00.000+00:00", "resolution": "Unresolved", "description": "Implement client-side validation for user input forms.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-133", "summary": "Improve logging system", "issueType": "Task", "status": "To Do", "priority": "Low", "assignee": "daniel.gray", "reporter": "lillian.price", "created": "2025-02-07T10:10:00.000+00:00", "updated": "2025-07-25T13:05:00.000+00:00", "resolution": "Unresolved", "description": "Enhance logging for better debugging capabilities.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-134", "summary": "Test API security", "issueType": "Task", "status": "In Progress", "priority": "High", "assignee": "jackson.james", "reporter": "addison.bennett", "created": "2025-02-08T12:35:00.000+00:00", "updated": "2025-07-25T14:40:00.000+00:00", "resolution": "Unresolved", "description": "Perform security testing on public API endpoints.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-135", "summary": "Optimize notification delivery", "issueType": "Task", "status": "Done", "priority": "Medium", "assignee": "samuel.wood", "reporter": "eleanor.barnes", "created": "2025-02-09T14:50:00.000+00:00", "updated": "2025-07-19T17:50:00.000+00:00", "resolution": "Fixed", "description": "Reduce latency in sending email notifications.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-136", "summary": "Add user role management", "issueType": "Story", "status": "In Review", "priority": "Medium", "assignee": "dylan.ross", "reporter": "hazel.ross", "created": "2025-02-10T16:15:00.000+00:00", "updated": "2025-07-25T10:50:00.000+00:00", "resolution": "Unresolved", "description": "Enable admin to manage user roles in the app.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-137", "summary": "Fix mobile app crashes", "issueType": "Bug", "status": "To Do", "priority": "High", "assignee": "nathan.henderson", "reporter": "violet.coleman", "created": "2025-02-11T18:30:00.000+00:00", "updated": "2025-07-25T12:10:00.000+00:00", "resolution": "Unresolved", "description": "Resolve crashes on iOS devices during login.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-138", "summary": "Update payment integration", "issueType": "Story", "status": "In Progress", "priority": "Medium", "assignee": "isaac.jenkins", "reporter": "aurora.perry", "created": "2025-02-12T09:45:00.000+00:00", "updated": "2025-07-25T15:30:00.000+00:00", "resolution": "Unresolved", "description": "Integrate PayPal as an additional payment option.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-139", "summary": "Enhance search filters", "issueType": "Story", "status": "Done", "priority": "Low", "assignee": "kyle.powell", "reporter": "luna.patterson", "created": "2025-02-13T11:20:00.000+00:00", "updated": "2025-07-21T16:25:00.000+00:00", "resolution": "Fixed", "description": "Add advanced filters to the search functionality.", "projectId": "Adani", "sprintId": "Sprint-2"},
    {"issueKey": "JIRA-140", "summary": "Implement data encryption", "issueType": "Story", "status": "In Review", "priority": "High", "assignee": "brandon.hughes", "reporter": "savannah.hughes", "created": "2025-02-14T13:35:00.000+00:00", "updated": "2025-07-25T11:20:00.000+00:00", "resolution": "Unresolved", "description": "Encrypt sensitive user data at rest.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-141", "summary": "Fix UI alignment issues", "issueType": "Bug", "status": "To Do", "priority": "Low", "assignee": "evan.flores", "reporter": "claire.butler", "created": "2025-02-15T15:50:00.000+00:00", "updated": "2025-07-25T13:35:00.000+00:00", "resolution": "Unresolved", "description": "Correct misaligned elements on the dashboard.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-142", "summary": "Add offline support", "issueType": "Story", "status": "In Progress", "priority": "Medium", "assignee": "angel.simmons", "reporter": "skylar.foster", "created": "2025-02-16T17:15:00.000+00:00", "updated": "2025-07-25T14:15:00.000+00:00", "resolution": "Unresolved", "description": "Enable basic offline functionality for the mobile app.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-143", "summary": "Optimize backend services", "issueType": "Task", "status": "Done", "priority": "High", "assignee": "adrian.gonzalez", "reporter": "paisley.gonzalez", "created": "2025-02-17T19:30:00.000+00:00", "updated": "2025-07-22T17:40:00.000+00:00", "resolution": "Fixed", "description": "Reduce memory usage of backend microservices.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-144", "summary": "Add audit logging", "issueType": "Story", "status": "In Review", "priority": "Medium", "assignee": "eric.washington", "reporter": "kennedy.brooks", "created": "2025-02-18T10:55:00.000+00:00", "updated": "2025-07-25T10:25:00.000+00:00", "resolution": "Unresolved", "description": "Implement logging for user actions in the app.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-145", "summary": "Fix data import bugs", "issueType": "Bug", "status": "To Do", "priority": "Medium", "assignee": "kevin.kelly", "reporter": "rowan.wood", "created": "2025-02-19T12:20:00.000+00:00", "updated": "2025-07-25T12:50:00.000+00:00", "resolution": "Unresolved", "description": "Resolve errors during CSV data import.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-146", "summary": "Update user documentation", "issueType": "Task", "status": "In Progress", "priority": "Low", "assignee": "justin.sanders", "reporter": "emma.ross", "created": "2025-02-20T14:35:00.000+00:00", "updated": "2025-07-25T15:40:00.000+00:00", "resolution": "Unresolved", "description": "Revise help docs for new features.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-147", "summary": "Test performance under load", "issueType": "Task", "status": "Done", "priority": "High", "assignee": "austin.price", "reporter": "mila.bennett", "created": "2025-02-21T16:50:00.000+00:00", "updated": "2025-07-23T18:15:00.000+00:00", "resolution": "Fixed", "description": "Conduct stress testing on the web app.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-148", "summary": "Add custom themes", "issueType": "Story", "status": "In Review", "priority": "Low", "assignee": "caleb.bennett", "reporter": "aria.wood", "created": "2025-02-22T18:15:00.000+00:00", "updated": "2025-07-25T11:55:00.000+00:00", "resolution": "Unresolved", "description": "Allow users to select custom UI themes.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-149", "summary": "Fix notification delays", "issueType": "Bug", "status": "To Do", "priority": "Medium", "assignee": "christian.barnes", "reporter": "penelope.barnes", "created": "2025-02-23T10:30:00.000+00:00", "updated": "2025-07-25T13:45:00.000+00:00", "resolution": "Unresolved", "description": "Resolve delays in push notification delivery.", "projectId": "Adani", "sprintId": "Sprint-3"},
    {"issueKey": "JIRA-150", "summary": "Enhance accessibility", "issueType": "Story", "status": "In Progress", "priority": "Medium", "assignee": "aaron.fisher", "reporter": "charlotte.fisher", "created": "2025-02-24T12:45:00.000+00:00", "updated": "2025-07-25T14:55:00.000+00:00", "resolution": "Unresolved", "description": "Improve app compliance with WCAG accessibility standards.", "projectId": "Adani", "sprintId": "Sprint-3"}
]

documents = [
    Document(
        page_content=f"Task ID: {task['issueKey']}\nTitle: {task['summary']}\nDescription: {task['description']}\nStatus: {task['status']}\nPriority: {task['priority']}\nAssignee: {task['assignee']}\nReporter: {task['reporter']}\nIssue Type: {task['issueType']}\nResolution: {task['resolution']}\nProject: {task['projectId']}\nSprint: {task['sprintId']}",
        metadata={"task_id": task["issueKey"], "status": task["status"], "priority": task["priority"], "assignee": task["assignee"], "issue_type": task["issueType"], "project_id": task["projectId"], "sprint_id": task["sprintId"]}
    )
    for task in jira_tasks
]

embeddings = OllamaEmbeddings(model="nomic-embed-text")
vectorstore = Chroma.from_documents(
    documents=documents,
    embedding=embeddings,
    persist_directory="./jira_tasks_chroma_db"
)
print("Jira tasks embedded and stored in Chroma DB.")